<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>TTLock Helper UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- You can remove Bootstrap if you prefer, it's just for quick styling -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="mb-4">TTLock Helper UI</h1>

  <!-- Settings -->
  <div class="card mb-4">
    <div class="card-header">
      Settings
    </div>
    <div class="card-body">
      <form method="post" action="/save_settings">
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">API Base URL</label>
            <input type="text" class="form-control" name="api_base_url"
                   value="{{ cfg.api_base_url }}">
            <div class="form-text">
              Examples: https://api.sciener.com, https://euapi.ttlock.com
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Redirect URI</label>
            <input type="text" class="form-control" name="redirect_uri"
                   value="{{ cfg.redirect_uri }}">
            <div class="form-text">
              Optional, e.g. your Home Assistant OAuth URL.
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Client ID</label>
            <input type="text" class="form-control" name="client_id"
                   value="{{ cfg.client_id }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">Client Secret</label>
            <input type="text" class="form-control" name="client_secret"
                   value="{{ cfg.client_secret }}">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" name="username"
                   value="{{ cfg.username }}">
            <div class="form-text">
              Use the returned username from "Register user" (e.g. ccajg_xxx1).
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Password (MD5)</label>
            <input type="text" class="form-control" name="password_md5"
                   value="{{ cfg.password_md5 }}">
            <div class="form-text">
              32-character lowercase MD5 of your real password.
            </div>
          </div>
        </div>

        <button type="submit" class="btn btn-primary">Save settings</button>
      </form>

      {% if register_error %}
        <div class="alert alert-info mt-3">{{ register_error }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Hash password -->
  <div class="card mb-4">
    <div class="card-header">
      Hash password (MD5)
    </div>
    <div class="card-body">
      <form method="post" action="/hash_password" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Plain text password</label>
          <input type="password" class="form-control" name="plain_password">
        </div>
        <div class="col-md-6">
          <label class="form-label">Hashed password (MD5)</label>
          <input type="text" class="form-control" value="{{ hashed_password or cfg.password_md5 }}" readonly>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-secondary">Hash &amp; Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Register user -->
  <div class="card mb-4">
    <div class="card-header">
      Register TTLock User (/v3/user/register)
    </div>
    <div class="card-body">
      <form method="post" action="/register_user" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">API Base URL</label>
          <input type="text" class="form-control" name="api_base_url" value="{{ cfg.api_base_url }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Username to register</label>
          <input type="text" class="form-control" name="username" value="{{ cfg.username }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Password (MD5)</label>
          <input type="text" class="form-control" name="password_md5" value="{{ cfg.password_md5 }}">
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-success">Register user</button>
        </div>
      </form>

      {% if register_error %}
        <div class="alert alert-danger mt-3">{{ register_error }}</div>
      {% endif %}

      {% if cfg.raw_register_response %}
        <div class="mt-3">
          <label class="form-label">Raw register response</label>
          <textarea class="form-control" rows="6" readonly>{{ cfg.raw_register_response }}</textarea>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Get access token -->
  <div class="card mb-4">
    <div class="card-header">
      Get Access Token (/oauth2/token)
    </div>
    <div class="card-body">
      <form method="post" action="/get_token" class="row g-3">
        <div class="col-md-4">
          <label class="form-label">API Base URL</label>
          <input type="text" class="form-control" name="api_base_url" value="{{ cfg.api_base_url }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">Redirect URI (optional)</label>
          <input type="text" class="form-control" name="redirect_uri" value="{{ cfg.redirect_uri }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">Username</label>
          <input type="text" class="form-control" name="username" value="{{ cfg.username }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Password (MD5)</label>
          <input type="text" class="form-control" name="password_md5" value="{{ cfg.password_md5 }}">
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-warning">Get access token</button>
        </div>
      </form>

      {% if token_error %}
        <div class="alert alert-danger mt-3">{{ token_error }}</div>
      {% endif %}

      {% if cfg.access_token %}
        <div class="mt-3">
          <label class="form-label">Access token</label>
          <textarea class="form-control" rows="3" readonly>{{ cfg.access_token }}</textarea>
        </div>
      {% endif %}

      {% if cfg.refresh_token %}
        <div class="mt-3">
          <label class="form-label">Refresh token</label>
          <textarea class="form-control" rows="3" readonly>{{ cfg.refresh_token }}</textarea>
        </div>
      {% endif %}

      {% if cfg.raw_token_response %}
        <div class="mt-3">
          <label class="form-label">Raw token response</label>
          <textarea class="form-control" rows="6" readonly>{{ cfg.raw_token_response }}</textarea>
        </div>
      {% endif %}
    </div>
  </div>

</div>
</body>
</html>
